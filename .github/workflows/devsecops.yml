name: Automatisation des tests DevSecOps
on: push
jobs:
  Dependances:
    runs-on: ubuntu-latest
    steps:
      - name: R√©cup√©ration du code
        uses: actions/checkout@v4

      - name: V√©rification du fichier requirements.txt
        run: |
          echo "Contr√¥le du fichier requirements.txt..."
          if [ ! -f requirements.txt ]; then
            echo "‚ùå Le fichier requirements.txt est manquant !"
            exit 1
          fi

          echo "‚úÖ Fichier requirements.txt trouv√©."
          echo "üîç V√©rification du format..."
          # V√©rifie si le fichier est vide ou contient des lignes incorrectes
          if ! grep -E '^[a-zA-Z0-9_.-]+(==[0-9a-zA-Z_.-]+)?$' requirements.txt >/dev/null 2>&1; then
            echo "‚ö†Ô∏è Attention : certaines lignes de requirements.txt semblent incorrectes."
          else
            echo "‚úÖ Le fichier requirements.txt semble bien form√©."
          fi

  Dockerfile:
    runs-on: ubuntu-latest
    needs: Dependances
    steps:
      - name: R√©cup√©ration du code
        uses: actions/checkout@v4

      - name: V√©rification du Dockerfile
        run: |
          echo "Contr√¥le du Dockerfile..."
          if [ ! -f Dockerfile ]; then
            echo "‚ùå Le fichier Dockerfile est manquant !"
            exit 1
          fi

          echo "‚úÖ Dockerfile trouv√©."
          echo "üîç Analyse rapide du contenu..."
          # Exemple de v√©rification : pr√©sence d'instructions essentielles
          if ! grep -q '^FROM' Dockerfile; then
            echo "‚ùå Le Dockerfile ne contient pas d'instruction FROM."
            exit 1
          fi

          if ! grep -q '^CMD' Dockerfile && ! grep -q '^ENTRYPOINT' Dockerfile; then
            echo "‚ö†Ô∏è Aucune commande CMD ou ENTRYPOINT trouv√©e."
          else
            echo "‚úÖ Dockerfile semble valide."
          fi

  Deploy:
    runs-on: ubuntu-latest
    needs: Dockerfile
    steps:
      - name: Deploy
        run: |
          echo "üöÄ Rien √† faire ici. Votre application est pr√™te √† √™tre d√©ploy√©e."
